<script type="text/javascript" src="assets/js/core/libraries/jquery_ui/core.min.js"></script>
<script type="text/javascript" src="assets/js/core/libraries/jquery_ui/effects.min.js"></script>
<script type="text/javascript" src="assets/js/core/libraries/jquery_ui/interactions.min.js"></script>
<script type="text/javascript" src="assets/js/plugins/extensions/cookie.js"></script>
<script type="text/javascript" src="assets/js/plugins/forms/styling/switchery.min.js"></script>
<script type="text/javascript" src="assets/js/plugins/forms/styling/uniform.min.js"></script>
<script type="text/javascript" src="assets/js/plugins/trees/fancytree_all.min.js"></script>
<script type="text/javascript" src="assets/js/plugins/trees/fancytree_childcounter.js"></script>
<div class="page-container">
	<div class="page-content">
		<div class="content-wrapper">
			<!-- 页头 -->
			<div class="page-header panel border-bottom-lg border-bottom-info" style="background-color: #fff;">
				<div class="breadcrumb-line">
					<ul class="breadcrumb">
						<li><a href="javascript:;" onclick="invoke('recruitment/index.html')"><i class="icon-home2 position-left"></i> 首页</a></li>
						<li><a href="javascript:;">活动参数</a></li>
						<li class="active">资源配套</li>
					</ul>
					<ul class="breadcrumb-elements">
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								<i class="icon-three-bars"></i>
								<span class="caret"></span>
							</a>
						</li>
					</ul>
				</div>
			</div>
		    <!--页头内容开始 -->
		    <div class="content">
		    	<div class="tabbable">
					<ul class="nav nav-pills">
						<li class="active"><a data-toggle="tab" href="#basic-pill1">购物中心</a></li>
						<li class=""><a data-toggle="tab" href="#basic-pill2">商家</a></li>
						<li class="dropdown">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#" aria-expanded="false">添加资源<span class="caret"></span></a>
							<ul class="dropdown-menu dropdown-menu-left">
								<li style="margin-bottom: 0px;">
									<a data-target="#add_resource" data-toggle="modal" class="btn btn-default btn-sm" type="button" style="border: 0px solid white;">购物中心</a>
									<!-- <a data-toggle="tab" href="#basic-pill4"></a> -->
								</li>
								<li style="margin-bottom: 0px;">
									<a data-target="#add_one_resource2" data-toggle="modal" class="btn btn-default btn-sm" type="button" style="border: 0px solid white;">商家</a>
									<!-- <a data-toggle="tab" href="#basic-pill4"></a> -->
								</li>
							</ul>
						</li>
					</ul>
				</div>
		    
		    	
		    	<!-- Basic datatable -->
					<div id="divShow" class="panel panel-flat col-md-12">
						<div class="panel-heading">
							<h5 class="panel-title">规则列表</h5>
							<div class="heading-elements">
								<ul class="icons-list">
				               		<li><a data-action="collapse"></a></li>
				               		<li><a data-action="reload"></a></li>
				               	</ul>
							</div>
						</div>
						<div id="container"> 
							<table id="example" class="table table-striped table-bordered table-hover">
								<thead>
						            <tr>
						            	<th>活动</th>
						                <th>资源</th>
						            </tr>
						        </thead>
							</table>
							</br>
						</div> 
					</div>
					
			</div>
		</div>
	</div>
</div>

<div id="add_resource" class="modal fade">
	<div class="modal-dialog modal-sm">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h5 class="modal-title">活动资源设置</h5>
			</div>

			<form action="#" class="form-horizontal">
				<div class="modal-body">
					<div class="form-group">
						<label class="control-label col-sm-3">活动类型</label>
						<div class="col-sm-9">
							<select id="TypeTree1">
							</select>
						</div>
					</div>

					<div class="form-group">
						<div class="table-responsive">
							<table class="table">
								<thead>
									<tr>
										<th class="col-sm-3">资源名称</th>
										<th class="col-sm-9">资源要求</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>模特</td>
										<td>身高-153</td>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td><input style="width: 60px;position: relative;top: -20px;" type="text" name="name"> </td>
										<td><textarea class="col-sm-9" name="req" rows="3" ></textarea><input style="position: relative;button: -1px;" type="button" id="add_one_resource" name="sure" value="添加"></td>
									</tr>
								</tfoot>
							</table>
							
						</div>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-link" data-dismiss="modal">关闭</button>
					<button type="submit" class="btn btn-primary">保存</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div id="add_one_resource2" class="modal fade">
	<div class="modal-dialog modal-sm">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h5 class="modal-title">活动资源设置</h5>
			</div>

			<form action="#" class="form-horizontal">
				<div class="modal-body">

					<div class="form-group">
						<label class="control-label col-sm-3">活动类型</label>
						<div class="col-sm-9">
							<select id="TypeTree2">
							</select>
						</div>
					</div>

					<div class="form-group">
						<label class="control-label col-sm-3">资源需求</label>
						<div class="col-sm-9">
							<!-- <div class="panel panel-flat">
				    		<div class="tree-ajax well border-left-info border-left-lg"></div>
			    			</div> -->
			    			<table id="treetable" >
							    <colgroup>
							    <col width="150px"></col>
							    <col width="30px"></col>
							    <col width="30px"></col>
							    <col width="30px"></col>
							    </colgroup>
							    <thead>
							      <tr> <th>资源名称</th>  <th>需求</th> <th colspan="2">+/-</th> </tr>
							    </thead>
							    <tbody>
							  	   <tr> <td></td>  <td></td><td></td> <td></td> </tr>
							    </tbody>
							  </table>
						</div>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-link" data-dismiss="modal">关闭</button>
					<button type="submit" class="btn btn-primary">保存</button>
				</div>
			</form>
		</div>
	</div>
</div>
<script type="text/javascript">
$(function() {
	var tree = $("#treetable").fancytree({
		extensions:["edit","table"],
		 source: {
		        url: "json/ACTIVITYRESOURCETREE.json"
		    },
		checkbox:false,
		table:{
			nodeColumnIdx:0
		},
		renderColumns:function(event,data){
			var node = data.node,
	          $tdList = $(node.tr).find(">td");
			$tdList.eq(0).css("text-align","left");
			$tdList.eq(1).html("<input style='width:50px;' type='text' name='requirement'>");
	        $tdList.eq(2).html("");
	        $tdList.eq(3).html("");
		},
	   
	    init: function(event, data) {
	        $('.has-tooltip .fancytree-title').tooltip();
	    },
	    activate:function(event,data){
	    	var node = data.node,
	          $tdList = $(node.tr).find(">td");
	    	$tdList.eq(1).html("<input style='width:50px;' type='text' name='requirement'>");
	        $tdList.eq(2).html("<input class='addbutton' type='button' name='add' value='+'>");
	        if(node.countChildren(deep=true) == 0)
	        {	        
	        	$tdList.eq(3).html("<input class='delbutton' type='button' name='del' value='-'>");
	        }
	    },
	    deactivate:function(event,data){
	    	var node = data.node,
	        $tdList = $(node.tr).find(">td");
	    	$tdList.eq(1).html("<input style='width:50px;' type='text' name='requirement'>");
	        $tdList.eq(2).html("");
	        $tdList.eq(3).html("");
	    },
		edit: {
	      triggerStart: ["f2", "dblclick", "shift+click", "mac+enter"],
	      beforeEdit: function(event, data){
	      },
	      edit: function(event, data){
	      },
	      beforeClose: function(event, data){
	      },
	      save: function(event, data){
	        console.log("save...", this, data);
	        return true;
	      },
	      close: function(event, data){
	        if( data.save ) {
	          $(data.node.span).addClass("pending");
	        }
	      }
	    },
		   
	});
	$("#treetable").on("click",".addbutton",function(){
		//tree.getActiveNode().editCreateNode(mode='child',init);
		var node = $("#treetable").fancytree("getActiveNode");
	      node.editCreateNode("child", {
	        title: "需求",
	        folder: false
	      });

	});
	$("#treetable").on("click",".delbutton",function(){
		//tree.getActiveNode().editCreateNode(mode='child',init);
		var node = $("#treetable").fancytree("getActiveNode");
		if(node.countChildren(deep=true) ==0){
			node.remove();
		}
	     /*  node.editCreateNode("child", {
	        title: "Node title",
	        folder: false
	      });
 */
	});
	$("#treetable").delegate("input[name=requirement]", "click", function(e){
		var node = $.ui.fancytree.getNode(e);
		node.setActive(flag=true);
		$(this).focus();
	});
	
	
	
	
	
	//=========
	$("#example").DataTable( {
		"ajax":"json/ACTIVITYRESOURCE.json" ,
        "columns": [
                    { "data": "活动类型" },
                    { "data": "资源需求" },
                ]
	} );
	$.getJSON("json/RBactivityType.json",function(data){
		$.each(data["data"],function(infoindex,info){
			$("#TypeTree1,#TypeTree2").append("<option>"+info["名称"]+"</option>");
		});
	});
	$("#add_one_resource").click(function(){
		var name = $(".table").find("input[name=name]").val();
		var req  = $(".table").find("textarea[name=req]").val();
		$(".table").find("tbody").append("<tr><td>"+name+"</td><td>"+req+"</td></td>");
		$(".table").find("input[name=name]").val("");
		$(".table").find("textarea[name=req]").val("");
	});
	$("textarea[name=req]").keydown(function(w){
		if(w.which == 13){
			$(this).val($(this).val()+",");
		}
	});
});
</script>
